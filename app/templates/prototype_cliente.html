{% extends "base.html" %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/consolidado.css') }}">
<style>
    /* Prototype Toggle */
    .view-switcher {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: white;
        padding: 15px;
        border-radius: 50px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        z-index: 9999;
        display: flex;
        gap: 10px;
    }

    .view-btn {
        padding: 10px 20px;
        border-radius: 25px;
        border: none;
        cursor: pointer;
        font-weight: bold;
        transition: all 0.3s;
    }

    .view-btn.active {
        background: var(--primary-color);
        color: white;
    }

    /* === SOCIAL STYLE === */
    .profile-header-social {
        background: white;
        border-radius: 12px;
        overflow: hidden;
        margin-bottom: 20px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    }

    .cover-photo {
        height: 200px;
        background: linear-gradient(120deg, #84fab0 0%, #8fd3f4 100%);
        position: relative;
    }

    .profile-info-bar {
        padding: 0 30px 20px 30px;
        position: relative;
        display: flex;
        align-items: flex-end;
    }

    .avatar-large {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        border: 5px solid white;
        margin-top: -60px;
        margin-right: 20px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }

    .user-details h1 {
        margin: 0;
        font-size: 24px;
        color: #333;
    }

    .user-details p {
        margin: 5px 0 0 0;
        color: #666;
    }

    .badges {
        gap: 5px;
        display: flex;
        margin-top: 10px;
    }

    .badge-pill {
        background: #eef2f7;
        color: #555;
        padding: 4px 10px;
        border-radius: 15px;
        font-size: 12px;
    }

    .social-grid {
        display: grid;
        grid-template-columns: 300px 1fr;
        gap: 20px;
    }

    .social-sidebar .card {
        padding: 20px;
        margin-bottom: 20px;
    }

    .info-list li {
        padding: 10px 0;
        border-bottom: 1px solid #eee;
        font-size: 14px;
    }

    .info-list li:last-child {
        border: none;
    }

    .info-label {
        font-weight: bold;
        color: #555;
        display: block;
        margin-bottom: 3px;
    }

    .status-box {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        margin-bottom: 20px;
    }

    .timeline-post {
        background: white;
        padding: 20px;
        border-radius: 8px;
        margin-bottom: 15px;
        border: 1px solid #eee;
        position: relative;
    }

    .timeline-post::before {
        content: '';
        position: absolute;
        top: 25px;
        left: -10px;
        width: 10px;
        height: 10px;
        background: white;
        transform: rotate(45deg);
        border-left: 1px solid #eee;
        border-bottom: 1px solid #eee;
    }

    .post-header {
        display: flex;
        align-items: center;
        margin-bottom: 15px;
    }

    .post-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        margin-right: 10px;
    }

    .post-meta small {
        color: #999;
        display: block;
    }

    .post-type-icon {
        margin-left: auto;
        font-size: 20px;
        opacity: 0.5;
    }

    /* === CRM STYLE === */
    .crm-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        background: white;
        padding: 20px;
        border-bottom: 1px solid #ddd;
    }

    .crm-stats {
        display: flex;
        gap: 30px;
    }

    .stat-item {
        text-align: right;
    }

    .stat-val {
        font-size: 24px;
        font-weight: bold;
        color: var(--primary-color);
    }

    .stat-label {
        font-size: 12px;
        color: #777;
        text-transform: uppercase;
    }

    .crm-layout {
        display: grid;
        grid-template-columns: 250px 1fr 300px;
        gap: 0;
        height: caLc(100vh - 150px);
        background: white;
        border: 1px solid #ddd;
        border-radius: 4px;
    }

    .crm-col {
        padding: 20px;
        border-right: 1px solid #eee;
        overflow-y: auto;
    }

    .crm-col:last-child {
        border-right: none;
        background: #f9f9f9;
    }

    .crm-tabs {
        display: flex;
        border-bottom: 1px solid #eee;
        margin-bottom: 20px;
    }

    .crm-tab {
        padding: 10px 15px;
        cursor: pointer;
        border-bottom: 2px solid transparent;
    }

    .crm-tab.active {
        border-bottom-color: var(--primary-color);
        font-weight: bold;
        color: var(--primary-color);
    }

    .compact-timeline-item {
        padding: 10px 0;
        border-bottom: 1px solid #f0f0f0;
        display: flex;
        gap: 10px;
    }

    .timeline-icon {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        background: #eee;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
    }

    /* Icons Colors */
    .type-visit {
        color: #9c27b0;
    }

    .type-budget {
        color: #28a745;
    }

    .type-whatsapp {
        color: #25D366;
    }

    .type-file {
        color: #007bff;
    }

    .visit-bg {
        background: #f3e5f5;
        color: #9c27b0;
    }

    .budget-bg {
        background: #e8f5e9;
        color: #28a745;
    }

    .whatsapp-bg {
        background: #e8f5e9;
        color: #25D366;
    }
</style>
{% endblock %}

{% block content %}

<!-- Toggle Controls -->
<div class="view-switcher">
    <button class="view-btn active" onclick="switchView('social')" id="btn-social">üé≠ Estilo Social</button>
    <button class="view-btn" onclick="switchView('crm')" id="btn-crm">üìä Estilo CRM</button>
</div>

<!-- ================= SOCIAL VIEW ================= -->
<div id="view-social" class="view-container">

    <div class="profile-header-social">
        <div class="cover-photo">
            <!-- Could be a map or project photo -->
        </div>
        <div class="profile-info-bar">
            <img src="{{ client.avatar }}" class="avatar-large">
            <div class="user-details">
                <h1>{{ client.name }} <small style="font-size:14px; color:#999; font-weight:normal;">({{ client.company
                        }})</small></h1>
                <p>Marcenaria ‚Ä¢ Cliente desde 2024 ‚Ä¢ √öltima visita: Hoje</p>
                <div class="badges">
                    {% for tag in client.tags %}
                    <span class="badge-pill">{{ tag }}</span>
                    {% endfor %}
                    <span class="badge-pill" style="background:#e3f2fd; color:#0d47a1;"> Gastos: {{ client.total_spent
                        }}</span>
                </div>
            </div>
            <div style="margin-left:auto;">
                <button class="btn btn-secondary">üìû Ligar</button>
                <button class="btn btn-primary">‚ûï Novo Or√ßamento</button>
            </div>
        </div>
    </div>

    <div class="social-grid">
        <!-- Sidebar Info -->
        <div class="social-sidebar">
            <div class="card">
                <h3>Sobre</h3>
                <ul class="info-list">
                    <li><span class="info-label">Email</span> {{ client.email }}</li>
                    <li><span class="info-label">Telefone</span> {{ client.phone }}</li>
                    <li><span class="info-label">Endere√ßo</span> {{ client.address }}</li>
                    <li><span class="info-label">Status</span> <span style="color:green">‚óè {{ client.status }}</span>
                    </li>
                </ul>
            </div>

            <div class="card">
                <h3>Arquivos Recentes</h3>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                    <div style="height:60px; background:#eee; border-radius:4px;"></div>
                    <div style="height:60px; background:#eee; border-radius:4px;"></div>
                    <div style="height:60px; background:#eee; border-radius:4px;"></div>
                </div>
                <button class="btn btn-sm btn-secondary" style="width:100%; margin-top:10px;">Ver Todos</button>
            </div>
        </div>

        <!-- Main Feed -->
        <div class="feed">
            <div class="status-box">
                <input type="text" placeholder="Escreva uma observa√ß√£o, cole uma nota ou agende algo..."
                    class="form-control" style="margin-bottom:10px;">
                <div style="display:flex; justify-content:space-between;">
                    <div>
                        <button class="btn btn-sm btn-secondary">üì∑ Foto</button>
                        <button class="btn btn-sm btn-secondary">üìÖ Agendar</button>
                    </div>
                    <button class="btn btn-sm btn-primary">Postar</button>
                </div>
            </div>

            <h3>Linha do Tempo</h3>

            {% for event in timeline %}
            <div class="timeline-post">
                <div class="post-header">
                    <img src="https://ui-avatars.com/api/?name={{ event.user }}&background=random" class="post-avatar">
                    <div class="post-meta">
                        <strong>{{ event.title }}</strong>
                        <small>{{ event.date }} ‚Ä¢ por {{ event.user }}</small>
                    </div>
                    <div class="post-type-icon type-{{ event.type }}">
                        {% if event.type == 'visit' %}üìç{% elif event.type == 'budget' %}üí∞{% elif event.type ==
                        'whatsapp' %}üí¨{% endif %}
                    </div>
                </div>
                <p>{{ event.desc }}</p>
                <!-- Actions -->
                <div style="border-top:1px solid #eee; padding-top:10px; margin-top:10px; display:flex; gap:15px;">
                    <a href="#" style="font-size:12px; color:#666;">Comentar</a>
                    <a href="#" style="font-size:12px; color:#666;">Ver Detalhes</a>
                </div>
            </div>
            {% endfor %}

        </div>
    </div>

</div>

<!-- ================= CRM VIEW ================= -->
<div id="view-crm" class="view-container" style="display:none;">

    <div class="crm-header">
        <div>
            <h2>{{ client.name }} | <small>{{ client.company }}</small></h2>
            <div style="font-size:12px; color:#666;">ID: #{{ client.id }} ‚Ä¢ Criado em 10/01/2024</div>
        </div>
        <div class="crm-stats">
            <div class="stat-item">
                <div class="stat-val">{{ client.total_spent }}</div>
                <div class="stat-label">Total Gasto</div>
            </div>
            <div class="stat-item">
                <div class="stat-val">2</div>
                <div class="stat-label">Or√ßamentos Abertos</div>
            </div>
            <div class="stat-item">
                <div class="stat-val">Alta</div>
                <div class="stat-label">Prioridade</div>
            </div>
        </div>
    </div>

    <div class="crm-layout">
        <!-- Col 1: Details -->
        <div class="crm-col">
            <h4>Dados de Contato</h4>
            <div style="margin-bottom:15px;">
                <label style="font-size:11px; color:#999; display:block;">EMAIL</label>
                <a href="#">{{ client.email }}</a>
            </div>
            <div style="margin-bottom:15px;">
                <label style="font-size:11px; color:#999; display:block;">TELEFONE</label>
                <a href="#">{{ client.phone }}</a>
            </div>
            <div style="margin-bottom:15px;">
                <label style="font-size:11px; color:#999; display:block;">ENDERE√áO</label>
                <span>{{ client.address }}</span>
            </div>

            <hr>

            <h4>Etiquetas</h4>
            <div style="display:flex; flex-wrap:wrap; gap:5px;">
                {% for tag in client.tags %}
                <span style="background:#ddd; border-radius:3px; padding:2px 6px; font-size:11px;">{{ tag }}</span>
                {% endfor %}
            </div>
        </div>

        <!-- Col 2: Activity Center -->
        <div class="crm-col">
            <div class="crm-tabs">
                <div class="crm-tab active">Atividades</div>
                <div class="crm-tab">E-mails</div>
                <div class="crm-tab">Notas</div>
                <div class="crm-tab">Arquivos</div>
            </div>

            <div
                style="background:#f0f7ff; padding:15px; border-radius:4px; margin-bottom:20px; border:1px solid #d0e3ff;">
                <strong style="color:#0056b3;">Pr√≥xima A√ß√£o:</strong> <br>
                Ligar para confirmar visita (Amanh√£, 10:00)
                <button class="btn btn-sm btn-success" style="float:right;">‚úì Feito</button>
            </div>

            <h4>Hist√≥rico</h4>
            {% for event in timeline %}
            <div class="compact-timeline-item">
                <div
                    class="timeline-icon {% if event.type == 'visit' %}visit-bg{% elif event.type == 'budget' %}budget-bg{% endif %}">
                    {% if event.type == 'visit' %}üìç{% elif event.type == 'budget' %}üí∞{% else %}‚óè{% endif %}
                </div>
                <div style="flex:1;">
                    <div style="display:flex; justify-content:space-between;">
                        <strong>{{ event.title }}</strong>
                        <small style="color:#999;">{{ event.date }}</small>
                    </div>
                    <div style="font-size:13px; color:#555; margin-top:2px;">{{ event.desc }}</div>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- Col 3: Business/Deals -->
        <div class="crm-col">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                <h4>Or√ßamentos ({{ budgets|length }})</h4>
                <button class="btn btn-sm btn-primary" style="font-size:16px;">+</button>
            </div>

            {% for bud in budgets %}
            <div
                style="background:white; padding:10px; border-radius:4px; box-shadow:0 1px 3px rgba(0,0,0,0.1); margin-bottom:10px; border-left: 4px solid {% if bud.status == 'Aprovado' %}green{% else %}orange{% endif %};">
                <div style="font-weight:bold; font-size:14px;">Or√ßamento #{{ bud.id }}</div>
                <div style="font-size:12px; color:#666;">{{ bud.items }}</div>
                <div style="display:flex; justify-content:space-between; margin-top:5px;">
                    <span style="font-weight:bold;">R$ {{ bud.value }}</span>
                    <small style="padding:2px 6px; background:#eee; border-radius:4px;">{{ bud.status }}</small>
                </div>
            </div>
            {% endfor %}

            <h4 style="margin-top:20px;">Produtos Mais Pedidos</h4>
            <ul style="font-size:12px; padding-left:20px; color:#666;">
                <li>MDF Freij√≥</li>
                <li>Puxador Zen</li>
            </ul>
        </div>
    </div>
</div>

<script>
    function switchView(view) {
        // Toggle Containers
        document.getElementById('view-social').style.display = view === 'social' ? 'block' : 'none';
        document.getElementById('view-crm').style.display = view === 'crm' ? 'block' : 'none';

        // Toggle Buttons
        document.getElementById('btn-social').classList.toggle('active', view === 'social');
        document.getElementById('btn-crm').classList.toggle('active', view === 'crm');
    }
</script>

{% endblock %}